# Two-stage demo: pretrain (HSE) + few-shot finetune (v0.1.0)

pipeline: "Pipeline_02_pretrain_fewshot"

base_configs:
  environment: "configs/base/environment/base.yaml"
  data: "configs/base/data/base_classification.yaml"
  model: "configs/base/model/backbone_dlinear.yaml"
  task: "configs/base/task/pretrain.yaml"
  trainer: "configs/base/trainer/default_single_gpu.yaml"

environment:
  project: "demo_pretrain_hse_then_fewshot"
  seed: 42
  output_dir: "results/demo/pretrain_hse_then_fewshot"
  notes: "Two-stage pretrain (HSE) + few-shot finetune demo."

data: 
  data_dir: "/home/xyc3090/data1/PHM-Vibench-base/data/dataset"
# 模型配置全部由 base_configs.model (backbone_dlinear.yaml) 提供

task:
  type: "pretrain"
  name: "hse_contrastive"
  # 预训练阶段在 CDDG 视角下，默认覆盖多个系统
  target_system_id: [1, 13, 6, 12, 19]
  target_domain_num: 1
  contrast_loss: "INFONCE"
  contrast_weight: 1.0
  classification_weight: 0.0
  temperature: 0.07

trainer:
  num_epochs: 20

stages:
  - name: "pretrain"
    description: "HSE contrastive pretraining"
    overrides:
      environment:
        stage_name: "pretrain"
      task:
        type: "pretrain"
        name: "hse_contrastive"
        training_stage: "pretrain"
      trainer:
        num_epochs: 20

  - name: "fewshot_finetune"
    description: "Few-shot finetune on target system"
    overrides:
      environment:
        stage_name: "fewshot_finetune"
      task:
        type: "FS"
        name: "classification"
        training_stage: "finetune"
        n_way: 5
        k_shot: 5
        q_query: 15
        episodes_per_epoch: 100
        lr: 0.001
        target_system_id: [1]
      data:
        window_size: 1024
        num_window: 32
      trainer:
        num_epochs: 10
